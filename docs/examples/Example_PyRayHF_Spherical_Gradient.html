<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<title>Example: PyRayHF Spherical Gradient Raytracing</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 9511 2024-01-13 09:50:07Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
Despite the name, some widely supported CSS2 features are used.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: gray; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic, pre.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/*
*   math2html: convert LaTeX equations to HTML output.
*
*   Copyright (C) 2009,2010 Alex Fernández
*                 2021      Günter Milde
*
*   Released under the terms of the `2-Clause BSD license'_, in short:
*   Copying and distribution of this file, with or without modification,
*   are permitted in any medium without royalty provided the copyright
*   notice and this notice are preserved.
*   This file is offered as-is, without any warranty.
*
* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause
*
*   Based on eLyXer: convert LyX source files to HTML output.
*   http://elyxer.nongnu.org/
*
*
* CSS file for LaTeX formulas.
*
* References: http://www.zipcon.net/~swhite/docs/math/math.html
*             http://www.cs.tut.fi/~jkorpela/math/
*/

/* Formulas */
.formula {
	text-align: center;
	margin: 1.2em 0;
	line-height: 1.4;
}
span.formula {
	white-space: nowrap;
}
div.formula {
	padding: 0.5ex;
	margin-left: auto;
	margin-right: auto;
}

/* Basic features */
a.eqnumber {
	display: inline-block;
	float: right;
	clear: right;
	font-weight: bold;
}
span.unknown {
	color: #800000;
}
span.ignored, span.arraydef {
	display: none;
}
.phantom {
	visibility: hidden;
}
.formula i {
	letter-spacing: 0.1ex;
}

/* Alignment */
.align-l {
	text-align: left;
}
.align-r {
	text-align: right;
}
.align-c {
	text-align: center;
}

/* Structures */
span.hspace {
	display: inline-block;
}
span.overline, span.bar {
	text-decoration: overline;
}
.fraction, .fullfraction, .textfraction {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
}
span.formula .fraction,
.textfraction,
span.smallmatrix {
	font-size: 80%;
	line-height: 1;
}
span.numerator {
	display: block;
	line-height: 1;
}
span.denominator {
	display: block;
	line-height: 1;
	padding: 0ex;
	border-top: thin solid;
}
.formula sub, .formula sup {
	font-size: 80%;
}
sup.numerator, sup.unit {
	vertical-align: 80%;
}
sub.denominator, sub.unit {
	vertical-align: -20%;
}
span.smallsymbol {
	font-size: 75%;
	line-height: 75%;
}
span.boldsymbol {
	font-weight: bold;
}
span.sqrt {
	display: inline-block;
	vertical-align: middle;
	padding: 0.1ex;
}
sup.root {
	position: relative;
	left: 1.4ex;
}
span.radical {
	display: inline-block;
	padding: 0ex;
	/* font-size: 160%; for DejaVu, not required with STIX */
	line-height: 100%;
	vertical-align: top;
	vertical-align: middle;
}

span.root {
	display: inline-block;
	border-top: thin solid;
	padding: 0ex;
	vertical-align: middle;
}
div.formula .bigoperator,
.displaystyle .bigoperator,
.displaystyle .bigoperator {
	line-height: 120%;
	font-size: 140%;
	padding-right: 0.2ex;
}
span.fraction .bigoperator,
span.scriptstyle .bigoperator {
	line-height: inherit;
	font-size: inherit;
	padding-right: 0;
}
span.bigdelimiter {
	display: inline-block;
}
span.bigdelimiter.size1 {
	transform: scale(1, 1.2);
	line-height: 1.2;
}
span.bigdelimiter.size2 {
	transform: scale(1, 1.62);
	line-height: 1.62%;

}
span.bigdelimiter.size3 {
	transform: scale(1, 2.05);
	line-height: 2.05%;
}
span.bigdelimiter.size4 {
	transform: scale(1, 2.47);
	line-height: 2.47%;
}
/* vertically stacked sub and superscript */
span.scripts {
	display: inline-table;
	vertical-align: middle;
	padding-right: 0.2ex;
}
.script {
	display: table-row;
	text-align: left;
	line-height: 150%;
}
span.limits {
	display: inline-table;
	vertical-align: middle;
}
.limit {
	display: table-row;
	line-height: 99%;
}
sup.limit, sub.limit {
	line-height: 100%;
}
span.embellished,
span.embellished > .base {
	display: inline-block;
}
span.embellished > sup,
span.embellished > sub {
	display: inline-block;
	font-size: 100%;
	position: relative;
	bottom: 0.3em;
	width: 0px;
}
span.embellished > sub {
	top: 0.4em;
}

/* Environments */
span.array, span.bracketcases, span.binomial, span.environment {
	display: inline-table;
	text-align: center;
	vertical-align: middle;
}
span.arrayrow, span.binomrow {
	display: table-row;
	padding: 0;
	border: 0;
}
span.arraycell, span.bracket, span.case, span.binomcell, span.environmentcell {
	display: table-cell;
	padding: 0ex 0.2ex;
	line-height: 1; /* 99%; */
	border: 0ex;
}
.environment.align > .arrayrow > .arraycell.align-l {
	padding-right: 2em;
}

/* Inline binomials */
span.binom {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
	font-size: 80%;
}
span.binomstack {
	display: block;
	padding: 0em;
}

/* Over- and underbraces */
span.overbrace {
	border-top: 2pt solid;
}
span.underbrace {
	border-bottom: 2pt solid;
}

/* Stackrel */
span.stackrel {
	display: inline-block;
	text-align: center;
}
span.upstackrel {
	display: block;
	padding: 0em;
	font-size: 80%;
	line-height: 64%;
	position: relative;
	top: 0.15em;

}
span.downstackrel {
	display: block;
	vertical-align: bottom;
	padding: 0em;
}

/* Fonts */
.formula {
	font-family: STIX, "DejaVu Serif", "DejaVu Math TeX Gyre", serif;
}
span.radical,   /* ensure correct size of square-root sign */
span.integral { /* upright integral signs for better alignment of indices */
	font-family: "STIXIntegralsUp", STIX;
	/* font-size: 115%; match apparent size with DejaVu */
}
span.bracket {
  /* some "STIX" and "DejaVu Math TeX Gyre" bracket pieces don't fit */
	font-family: "DejaVu Serif", serif;
}
span.mathsf, span.textsf {
	font-family: sans-serif;
}
span.mathrm, span.textrm {
	font-family: STIX, "DejaVu Serif", "DejaVu Math TeX Gyre", serif;
}
span.mathtt, span.texttt {
	font-family: monospace;
}
span.text, span.textnormal,
span.mathsf, span.mathtt, span.mathrm {
	font-style: normal;
}
span.fraktur {
	font-family: "Lucida Blackletter", eufm10, blackletter;
}
span.blackboard {
	font-family: Blackboard, msbm10, serif;
}
span.scriptfont {
	font-family: "Monotype Corsiva", "Apple Chancery", "URW Chancery L", cursive;
	font-style: italic;
}
span.mathscr {
  font-family: MathJax_Script, rsfs10,  cursive;
  font-style: italic;
}
span.textsc {
	font-variant: small-caps;
}
span.textsl {
	font-style: oblique;
}

/* Colors */
span.colorbox {
	display: inline-block;
	padding: 5px;
}
span.fbox {
	display: inline-block;
	border: thin solid black;
	padding: 2px;
}
span.boxed, span.framebox {
	display: inline-block;
	border: thin solid black;
	padding: 5px;
}

</style>
</head>
<body>
<div class="document" id="example-pyrayhf-spherical-gradient-raytracing">
<h1 class="title">Example: PyRayHF Spherical Gradient Raytracing</h1>

<div class="section" id="background-ray-equations-in-spherical-geometry">
<h1>Background: Ray Equations in Spherical Geometry</h1>
<p>In spherical geometry, rays are described in <span class="formula">(<i>r</i>, <i>ϕ</i>)</span> coordinates:</p>
<ul class="simple">
<li><strong>Radial coordinate</strong>: <span class="formula"><i>r</i> = <i>R</i><sub><i>E</i></sub> + <i>z</i></span> [km]</li>
<li><strong>Azimuthal coordinate</strong>: <span class="formula"><i>ϕ</i></span> = surface arc angle [rad]</li>
<li><strong>Unit tangent vector</strong>: <span class="formula"><b>v</b> = (<i>v</i><sub><i>r</i></sub>, <i>v</i><sub><i>ϕ</i></sub>)</span></li>
<li><strong>Arc length</strong>: <span class="formula"><i>s</i></span> [km]</li>
<li><strong>Refractive index field</strong>: <span class="formula"><i>n</i>(<i>r</i>, <i>ϕ</i>) = <i>μ</i></span> (phase index)</li>
</ul>
<p>The ray equations become:</p>
<div class="formula">
<span class="fraction"><span class="ignored">(</span><span class="numerator"><i>dr</i></span><span class="ignored">)/(</span><span class="denominator"><i>ds</i></span><span class="ignored">)</span></span> = <i>v</i><sub><i>r</i></sub>
</div>
<div class="formula">
<span class="fraction"><span class="ignored">(</span><span class="numerator"><i>d</i><i>ϕ</i></span><span class="ignored">)/(</span><span class="denominator"><i>ds</i></span><span class="ignored">)</span></span> = <span class="fraction"><span class="ignored">(</span><span class="numerator"><i>v</i><sub><i>ϕ</i></sub></span><span class="ignored">)/(</span><span class="denominator"><i>r</i></span><span class="ignored">)</span></span>
</div>
<div class="formula">
<span class="fraction"><span class="ignored">(</span><span class="numerator"><i>dv</i><sub><i>r</i></sub></span><span class="ignored">)/(</span><span class="denominator"><i>ds</i></span><span class="ignored">)</span></span> = <span class="fraction"><span class="ignored">(</span><span class="numerator">1</span><span class="ignored">)/(</span><span class="denominator"><i>μ</i></span><span class="ignored">)</span></span><span class="array"><span class="arrayrow"><span class="bracket align-left">⎛</span></span><span class="arrayrow"><span class="bracket align-left">⎝</span></span></span><span class="fraction"><span class="ignored">(</span><span class="numerator">∂<i>μ</i></span><span class="ignored">)/(</span><span class="denominator">∂<i>r</i></span><span class="ignored">)</span></span> − (∇<i>μ</i>⋅<b>v</b>)<i>v</i><sub><i>r</i></sub><span class="array"><span class="arrayrow"><span class="bracket align-right">⎞</span></span><span class="arrayrow"><span class="bracket align-right">⎠</span></span></span> + <span class="fraction"><span class="ignored">(</span><span class="numerator"><i>v</i><span class="scripts"><sup class="script">2</sup><sub class="script"><i>ϕ</i></sub></span></span><span class="ignored">)/(</span><span class="denominator"><i>r</i></span><span class="ignored">)</span></span>
</div>
<div class="formula">
<span class="fraction"><span class="ignored">(</span><span class="numerator"><i>dv</i><sub><i>ϕ</i></sub></span><span class="ignored">)/(</span><span class="denominator"><i>ds</i></span><span class="ignored">)</span></span> = <span class="fraction"><span class="ignored">(</span><span class="numerator">1</span><span class="ignored">)/(</span><span class="denominator"><i>μ</i></span><span class="ignored">)</span></span><span class="array"><span class="arrayrow"><span class="bracket align-left">⎛</span></span><span class="arrayrow"><span class="bracket align-left">⎝</span></span></span><span class="fraction"><span class="ignored">(</span><span class="numerator">1</span><span class="ignored">)/(</span><span class="denominator"><i>r</i></span><span class="ignored">)</span></span><span class="fraction"><span class="ignored">(</span><span class="numerator">∂<i>μ</i></span><span class="ignored">)/(</span><span class="denominator">∂<i>ϕ</i></span><span class="ignored">)</span></span> − (∇<i>μ</i>⋅<b>v</b>)<i>v</i><sub><i>ϕ</i></sub><span class="array"><span class="arrayrow"><span class="bracket align-right">⎞</span></span><span class="arrayrow"><span class="bracket align-right">⎠</span></span></span> − <span class="fraction"><span class="ignored">(</span><span class="numerator"><i>v</i><sub><i>r</i></sub><i>v</i><sub><i>ϕ</i></sub></span><span class="ignored">)/(</span><span class="denominator"><i>r</i></span><span class="ignored">)</span></span>
</div>
<p>Here the geometry includes Earth curvature explicitly, making this method essential
for long-range HF raytracing.</p>
</div>
<div class="section" id="specifics-in-pyrayhf">
<h1>Specifics in PyRayHF</h1>
<ul class="simple">
<li>Geometry (bending) uses the <strong>phase index μ</strong></li>
<li>Group delay integrates the <strong>group index μ'</strong> (mup) if provided via <tt class="docutils literal">mup_func</tt></li>
<li>Refractive index gradients (<span class="formula">∂<i>μ</i> ⁄ ∂<i>r</i></span>,
<span class="formula">∂<i>μ</i> ⁄ ∂<i>ϕ</i></span>) are provided by
<tt class="docutils literal">build_refractive_index_interpolator_rphi</tt></li>
<li>Termination conditions stop the ray when it:<ul>
<li>Hits the ground (<span class="formula"><i>r</i> = <i>R</i><sub><i>E</i></sub> + <i>z</i><sub><span class="text">ground</span></sub></span>)</li>
<li>Leaves the radial or azimuthal bounds</li>
<li>Exceeds maximum arc length</li>
</ul>
</li>
</ul>
<p>This method is the most realistic in PyRayHF since it accounts for <strong>curved-Earth
geometry</strong> while allowing for horizontally varying ionospheres.</p>
</div>
<div class="section" id="how-to-run">
<h1>How to run</h1>
<ol class="arabic simple">
<li>Import libraries.</li>
</ol>
<pre class="literal-block">
import numpy as np
import pickle
import matplotlib.pyplot as plt
from PyRayHF.library import find_X, find_Y, find_mu_mup
from PyRayHF.library import build_refractive_index_interpolator
from PyRayHF.library import trace_ray_cartesian_gradient
from scipy.interpolate import RegularGridInterpolator
</pre>
<p>2. Load input arrays from the example.
See Example_Generate_Input_Arrays for how to create input arrays using PyIRI.</p>
<pre class="literal-block">
file_open = 'Example_input.p'
input_arrays = pickle.load(open(file_open, 'rb'))
alt_km = input_arrays[&quot;alt&quot;]
Ne = input_arrays[&quot;den&quot;]
Babs = input_arrays[&quot;bmag&quot;]
bpsi = input_arrays[&quot;bpsi&quot;]
</pre>
<ol class="arabic simple" start="3">
<li>Ensure that the ground level is included:</li>
</ol>
<pre class="literal-block">
h_ground = 0
if alt_km[0] &gt; h_ground:
    Ne0 = np.interp(h_ground, alt_km, Ne)
    Babs0 = np.interp(h_ground, alt_km, Babs)
    bpsi0 = np.interp(h_ground, alt_km, bpsi)
    alt_km = np.insert(alt_km, 0, h_ground)
    Ne = np.insert(Ne, 0, Ne0)
    Babs = np.insert(Babs, 0, Babs0)
    bpsi = np.insert(bpsi, 0, bpsi0)
</pre>
<ol class="arabic simple" start="4">
<li>Add some gradient:</li>
</ol>
<pre class="literal-block">
Ne_gradient = Ne_grid * (1.0 + 0.5 * (Xg / Xg.max()))
</pre>
<ol class="arabic simple" start="5">
<li>Calculate plasma parameters:</li>
</ol>
<pre class="literal-block">
X = find_X(Ne_gradient, f0_Hz)
Y = find_Y(f0_Hz, Babs_grid)

mu, mup = find_mu_mup(X, Y, bpsi_grid, mode)
mup = np.where((mup &lt; 1e-3) | np.isnan(mup), np.nan, mup)
mup0 = mup[0]
</pre>
<ol class="arabic simple" start="6">
<li>Build interpolators</li>
</ol>
<pre class="literal-block">
n_and_grad = build_refractive_index_interpolator(z_grid, x_grid, mu)
mup_interp = RegularGridInterpolator((z_grid, x_grid),
                                    mup,
                                    bounds_error=False,
                                    fill_value=np.nan)
mup_func = lambda x, z: mup_interp(np.column_stack([z, x]))
</pre>
<ol class="arabic simple" start="6">
<li>Raytrace:</li>
</ol>
<pre class="literal-block">
result = trace_ray_cartesian_gradient(n_and_grad=n_and_grad,
                                    x0_km=0.0,
                                    z0_km=0.0,
                                    elevation_deg=elevation_deg,
                                    s_max_km=4000.0,
                                    max_step_km=5.0,
                                    z_max_km=600.0,
                                    x_min_km=0.0,
                                    x_max_km=1000.0,
                                    mup_func=mup_func)
</pre>
<ol class="arabic simple" start="7">
<li>Plot the results:</li>
</ol>
<pre class="literal-block">
fig, ax = plt.subplots(1, 1)
fig.set_size_inches(6, 3)
ax_plot = ax
ax_plot.set_xlim(0, 700)
ax_plot.set_ylim(0, 600)
ax_plot.set_facecolor(&quot;lightgray&quot;)
ax_plot.set_ylabel('Vertical Distance (km)')
ax_plot.set_xlabel('Horizontal Distance (km)')
vmin = 0
vmax = 1.2e12
color_ticks = np.arange(vmin, vmax + 2e11, 2e11)
pc = ax_plot.pcolormesh(Xg, Zg, Ne_gradient, shading='auto',
                        cmap='plasma', vmin=vmin, vmax=vmax)
ax_plot.plot(result['x'], result['z'], c='black', label='Gradient')
ax_plot.set_title(f&quot;Cartesian Gradient (El={elevation_deg:.1f}°, f={f0_Hz/1e6} MHz)&quot;, fontsize=11)
plt.colorbar(pc, label='Electron Density (m$^{-3}$)', ax=ax_plot,
            ticks=color_ticks)
ax.legend()
plt.show()
</pre>
<img alt="Snells Law." class="align-center" src="figures/Cartesian_Gradient.png" style="width: 500px;" />
<ol class="arabic simple">
<li>Print diagnostics:</li>
</ol>
<pre class="literal-block">
print('--------------------------------------------------')
print('Gradient-based raytracing in a medium with gradient:')
print('--------------------------------------------------')
print('Group Path (km): ', result['group_path_km'])
print('Group delay (sec): ', result['group_delay_sec'])
print('Ground_ Range (km): ', result['ground_range_km'])
print('x midpoint (km): ', result['x_midpoint'])
print('z midpoint (km): ', result['z_midpoint'])
</pre>
</div>
<div class="section" id="gradient-based-raytracing-in-a-medium-with-gradient">
<h1>Gradient-based raytracing in a medium with gradient:</h1>
<p>Group Path (km):  885.8935955316156</p>
<p>Group delay (sec):  0.0033971066053262392</p>
<p>Ground Range (km):  626.4220854230803</p>
<p>x midpoint (km):  355.28696968480824</p>
<p>z midpoint (km):  296.41432345069234</p>
</div>
</div>
</body>
</html>
